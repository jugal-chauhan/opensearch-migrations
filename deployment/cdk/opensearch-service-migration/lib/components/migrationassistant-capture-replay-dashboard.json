{
    "variables": [
        {
            "type": "property",
            "property": "SourceDomainName",
            "inputType": "select",
            "id": "SRC_DOMAIN_NAME",
            "label": "Source Cluster Domain",
            "search": "{AWS/ES,ClientId,DomainName} MetricName=\"CPUUtilization\"",
            "populateFrom": "DomainName",
            "defaultValue": "placeholder-source",
            "visible": true
        },
        {
            "type": "property",
            "property": "region",
            "inputType": "input",
            "id": "REGION",
            "label": "Region",
            "defaultValue": "${AWS::Region}",
            "visible": false
        },
        {
            "type": "property",
            "property": "TargetDomainName",
            "inputType": "select",
            "id": "TGT_DOMAIN_NAME",
            "label": "Target Cluster Domain",
            "search": "{AWS/ES,ClientId,DomainName} MetricName=\"CPUUtilization\"",
            "populateFrom": "DomainName",
            "defaultValue": "placeholder-target",
            "visible": true
        },
        {
            "type": "pattern",
            "pattern": "MA_STAGE",
            "inputType": "input",
            "id": "MA_STAGE",
            "label": "Migration Stage",
            "defaultValue": "dev",
            "visible": true
        },
        {
            "type": "pattern",
            "pattern": "ACCOUNT_ID",
            "inputType": "input",
            "id": "ACCOUNT_ID",
            "label": "Account ID",
            "defaultValue": "116981770455",
            "visible": false
        }
    ],
    "widgets": [
        {
            "height": 1,
            "width": 24,
            "y": 0,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Traffic Capture",
                "background": "transparent"
            }
        },
        {
            "height": 9,
            "width": 11,
            "y": 1,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ { "expression": "(m1-m2)", "label": "Integrity Gap", "id": "e1", "region": "us-west-1" } ],
                    [ "OpenSearchMigrations", "bytesWrittenToTarget", "OTelLib", "replayer", { "region": "us-west-1", "id": "m1", "label": "Replayed on T" } ],
                    [ ".", "bytesRead", ".", "captureProxy", { "label": "Captured from S", "region": "us-west-1", "id": "m2" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "us-west-1",
                "stat": "Sum",
                "period": 60,
                "title": "Captured vs Replayed Bytes",
                "yAxis": {
                    "left": {
                        "label": "Bytes"
                    }
                }
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 1,
            "x": 11,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "OpenSearchMigrations", "activeConnection", "OTelLib", "captureProxy" ]
                ],
                "sparkline": true,
                "view": "singleValue",
                "region": "us-west-1",
                "stat": "Average",
                "period": 60,
                "title": "Active Proxy Connections",
                "liveData": true
            }
        },
        {
            "height": 1,
            "width": 24,
            "y": 10,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Error Analysis",
                "background": "transparent"
            }
        },
        {
            "height": 10,
            "width": 11,
            "y": 11,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "OpenSearchMigrations", "gatheringResponseCount", "OTelLib", "captureProxy", { "label": "captureProxy gatheringResponseCount" } ],
                    [ "AWS/ApplicationELB", "HTTPCode_Target_4XX_Count", "TargetGroup", "targetgroup/ALBSourceProxy-dev-TG/e642595a90e5038d", "AvailabilityZone", "us-west-1b", "LoadBalancer", "app/MigrationAssistant-dev/623c250c55648626" ]
                ],
                "view": "timeSeries",
                "stacked": true,
                "title": "4xx/5xx Errors by Origin",
                "region": "us-west-1",
                "stat": "Sum",
                "period": 60
            }
        },
        {
            "height": 10,
            "width": 12,
            "y": 11,
            "x": 11,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ { "expression": "(m1/m3) * 100", "label": "Expression1", "id": "e1", "region": "us-west-1" } ],
                    [ "AWS/ApplicationELB", "HTTPCode_Target_4XX_Count", "TargetGroup", "targetgroup/ALBSourceProxy-dev-TG/e642595a90e5038d", "LoadBalancer", "app/MigrationAssistant-dev/623c250c55648626", { "id": "m1", "region": "us-west-1" } ],
                    [ ".", "RequestCount", ".", ".", ".", ".", { "id": "m3", "region": "us-west-1" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "title": "Source Proxy Error Rate (%) Over Time",
                "region": "us-west-1",
                "stat": "Average",
                "period": 300,
                "yAxis": {
                    "left": {
                        "label": "Error %"
                    }
                },
                "annotations": {
                    "horizontal": [
                        {
                            "label": "Error",
                            "value": 0.99,
                            "fill": "above"
                        }
                    ]
                }
            }
        },
        {
            "height": 1,
            "width": 24,
            "y": 21,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Kafka Integration",
                "background": "transparent"
            }
        },
        {
            "height": 10,
            "width": 11,
            "y": 22,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "OpenSearchMigrations", "kafkaCommitCount", "OTelLib", "replayer" ],
                    [ ".", "kafkaCommitDuration", ".", ".", { "stat": "Average" } ],
                    [ "AWS/Kafka", "MessagesInPerSec", "Cluster Name", "migration-msk-cluster-dev", "Broker ID", "1" ],
                    [ "...", "2" ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "title": "Kafka Message Commit Rate",
                "region": "us-west-1",
                "stat": "Sum",
                "period": 60,
                "setPeriodToTimeRange": true
            }
        },
        {
            "height": 10,
            "width": 12,
            "y": 22,
            "x": 11,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "OpenSearchMigrations", "lagBetweenSourceAndTargetRequests", "OTelLib", "replayer" ],
                    [ ".", "scheduleLag", ".", "." ]
                ],
                "sparkline": true,
                "view": "singleValue",
                "title": "Replayer Consumer Lag (ms)",
                "region": "us-west-1",
                "stat": "Maximum",
                "period": 60,
                "setPeriodToTimeRange": false,
                "trend": true,
                "liveData": true
            }
        },
        {
            "height": 1,
            "width": 24,
            "y": 32,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Replayer Performance"
            }
        },
        {
            "height": 9,
            "width": 11,
            "y": 33,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ { "expression": "(m1/m2)*10", "label": "Replay Speed Multiplier", "id": "e1" } ],
                    [ "OpenSearchMigrations", "kafkaBytesRead", "OTelLib", "replayer", { "id": "m1", "visible": false } ],
                    [ ".", "bytesWrittenToTarget", ".", ".", { "id": "m2", "visible": false } ]
                ],
                "view": "gauge",
                "title": "Current Replay Speed Multiplier",
                "region": "us-west-1",
                "stat": "Sum",
                "period": 60,
                "yAxis": {
                    "left": {
                        "min": 1,
                        "max": 10
                    }
                }
            }
        },
        {
            "height": 9,
            "width": 12,
            "y": 33,
            "x": 11,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ECS", "CPUUtilization", "ServiceName", "migration-dev-traffic-replayer-default", "ClusterName", "migration-dev-ecs-cluster" ],
                    [ ".", "MemoryUtilization", ".", ".", ".", "." ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "title": "Replayer Task Resources",
                "region": "us-west-1",
                "stat": "Average",
                "period": 60,
                "yAxis": {
                    "left": {
                        "label": "Utilization %"
                    }
                }
            }
        },
        {
            "height": 1,
            "width": 24,
            "y": 42,
            "x": 0,
            "type": "text",
            "properties": {
                "markdown": "# Cluster Health"
            }
        },
        {
            "height": 6,
            "width": 11,
            "y": 43,
            "x": 0,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ES", "SearchableDocuments", "DomainName", "target-cali", "ClientId", "116981770455", { "label": "Target Cluster" } ],
                    [ "...", "source-cali", ".", ".", { "label": "Source Cluster" } ]
                ],
                "sparkline": true,
                "view": "singleValue",
                "region": "us-west-1",
                "stat": "Sum",
                "period": 60,
                "title": "Source vs Target Document Count"
            }
        },
        {
            "height": 6,
            "width": 12,
            "y": 43,
            "x": 11,
            "type": "metric",
            "properties": {
                "metrics": [
                    [ "AWS/ES", "IndexingLatency", "DomainName", "source-cali", "ClientId", "116981770455", { "label": "Source Cluster" } ],
                    [ "...", "target-cali", ".", ".", { "label": "Target Cluster" } ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "title": "Indexing Latency Comparison",
                "region": "us-west-1",
                "stat": "Average",
                "period": 60,
                "yAxis": {
                    "left": {
                        "label": "Latency (ms)"
                    }
                }
            }
        }
    ]
}